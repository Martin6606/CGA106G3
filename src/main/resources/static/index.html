<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>DarkPan - Bootstrap 5 Admin Template</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <meta content="" name="keywords" />
    <meta content="" name="description" />

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon" />

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&family=Roboto:wght@500;700&display=swap"
      rel="stylesheet"
    />

    <!-- Icon Font Stylesheet -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />
    <link
      href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css"
      rel="stylesheet"
    />

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet" />
    <style>
      #chat {
        
        position: fixed;
        
        bottom: 0;
        
        right: 100px;
        width: 450px;
        height: 50px;
    }
    .showChat{
        height: 550px !important;
    }
    </style>
  </head>

  <body>
    <div class="container-fluid position-relative d-flex p-0">
      <!-- Spinner Start -->
      <div
        id="spinner"
        class="show bg-dark position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center"
      >
        <div
          class="spinner-border text-primary"
          style="width: 3rem; height: 3rem"
          role="status"
        >
          <span class="sr-only">Loading...</span>
        </div>
      </div>
      <!-- Spinner End -->

      <!-- Sidebar Start -->
      <div class="sidebar pe-4 pb-3">
        <nav class="navbar bg-secondary navbar-dark">
          <a href="index.html" class="navbar-brand mx-4 mb-3">
            <h3 class="text-primary">
                <img src="img/lycris.gif" style="width: 60px;">
             </i>彼岸
            </h3>
          </a>
          
          <div class="navbar-nav w-100" id="sidebar">
            <!-- <a href="#" class="nav-item nav-link"><i class="bi bi-tools"></i></i> 服務管理</a>
                    <a href="#" class="nav-item nav-link"><i class="bi bi-folder-plus"></i></i> 禮儀服務</a>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="fa fa-th me-2"></i>行程查詢</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="empschedule.html" class="dropdown-item">個人排程瀏覽</a>
                            <a href="locschedule.html" class="dropdown-item">場地排程瀏覽</a>
                            
                        </div>
                    </div>
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="bi bi-pencil-square"></i> 訂單管理</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="#" class="dropdown-item">方案訂單管理</a>
                            <a href="#" class="dropdown-item">追思品訂單管理</a>
                            
                        </div>
                    </div>
                    <a href="#" class="nav-item nav-link"><i class="bi bi-person-lines-fill"></i> 會員管理</a>
                    
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="bi bi-window"></i> 網站管理</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="#" class="dropdown-item">網站資訊管理</a>
                            <a href="#" class="dropdown-item">智能客服管理</a>
                            
                        </div>
                    </div>
                    
                    <div class="nav-item dropdown">
                        <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown"><i class="fa fa-laptop me-2"></i>後台管理</a>
                        <div class="dropdown-menu bg-transparent border-0">
                            <a href="empManage.html" class="dropdown-item">員工管理</a>
                            <a href="locManage.html" class="dropdown-item">場地管理</a>
                            
                        </div>
                    </div> -->
          </div>
        </nav>
      </div>
      <!-- Sidebar End -->

      <!-- Content Start -->
      <div class="content">
        <!-- Navbar Start -->
        <nav
          class="navbar navbar-expand bg-secondary navbar-dark sticky-top px-4 py-0"
        >
          <a href="index.html" class="navbar-brand d-flex d-lg-none me-4">
            <h2 class="text-primary mb-0"><i class="fa fa-user-edit"></i></h2>
          </a>
          <a href="#" class="sidebar-toggler flex-shrink-0">
            <i class="fa fa-bars"></i>
          </a>
          
          <div class="navbar-nav align-items-center ms-auto">
            
            <div class="nav-item dropdown">
              <a
                href="#"
                class="nav-link dropdown-toggle"
                data-bs-toggle="dropdown"
              >
                <!-- <img
                  class="rounded-circle me-lg-2"
                  src="img/user.jpg"
                  alt=""
                  style="width: 40px; height: 40px"
                /> -->
                <span class="d-none d-lg-inline-flex " id="ename"></span>
              </a>
              <div
                class="dropdown-menu dropdown-menu-end bg-secondary border-0 rounded-0 rounded-bottom m-0"
              >
                <a href="#" class="dropdown-item">個人資料</a>
                
                <a href="#" class="dropdown-item" id="logOut">登出</a>
              </div>
            </div>
          </div>
        </nav>
        <!-- Navbar End -->

        <!-- Sale & Revenue Start -->

        <!-- Widgets End -->

        <!-- Footer Start -->
        <div class="p-2 mb-2 bg-white text-dark" id="chat">
          <div class="p-2 mb-2 bg-danger text-white" id="chatBar" style="position: sticky;">
              <i class="bi bi-arrow-bar-left" id="chatBackbtn"></i>
              <span>聊天室</span>
             
          </div>
          <div style="background-color: lightblue; width: 100%;height: 80%;">
            <div id="messageArea">

            </div>
          </div>
          <div class="inputHolder">
              <input type="text" id = "chatInput" style="width: 350px;" onkeydown="if (event.keyCode == 13) send();">
              <button type="button" class="btn btn-outline-danger m-2" id="chatSendbtn" onclick="send();">送出</button>
          </div>
        </div>
        <!-- Footer End -->
      </div>
      <!-- Content End -->

      <!-- Back to Top -->
      
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/chart/chart.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.4/sockjs.min.js"></script>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

    <!-- Template Javascript -->
    
    <script src="js/main.js"></script>
    <script >
        document.getElementById("ename").textContent=sessionStorage.getItem("ename");
        document.getElementById("logOut").addEventListener("click",()=>{
            sessionStorage.clear()
            location.replace("/EmpLogin.html")
        })
    </script>

    <script>
      window.onload = function () {
        let sidebar = document.getElementById("sidebar");
        let perList = sessionStorage.getItem("perList");

        for (let per of perList) {
          switch (per) {
            case "1":
              let side1 = document.createElement("a");
              let icon1 = document.createElement("i");
              side1.setAttribute("class", "nav-item nav-link");
              side1.setAttribute("href", "#");
              icon1.setAttribute("class", "bi bi-tools");
              side1.append(icon1);
              side1.append(" 服務管理");
              sidebar.append(side1);
              break;
            case "2":
              let side2 = document.createElement("a");
              let icon2 = document.createElement("i");
              side2.setAttribute("class", "nav-item nav-link");
              side2.setAttribute("href", "#");
              icon2.setAttribute("class", "bi bi-folder-plus");
              side2.append(icon2);
              side2.append(" 禮儀服務");
              sidebar.append(side2);
              break;
            case "3":
              let side3 = document.createElement("a");
              let icon3 = document.createElement("i");
              let toggle3 = document.createElement("div");
              toggle3.setAttribute("class", "nav-item dropdown");
              side3.setAttribute("class", "nav-link dropdown-toggle");
              side3.setAttribute("data-bs-toggle", "dropdown");
              side3.setAttribute("href", "#");
              icon3.setAttribute("class", "bi bi-pencil-square");
              side3.append(icon3);
              side3.append(" 行程查詢");
              toggle3.append(side3);
              let toggleList3 = document.createElement("div");
              toggleList3.setAttribute(
                "class",
                "dropdown-menu bg-transparent border-0"
              );
              let toggleList31 = document.createElement("a");
              toggleList31.setAttribute("href", "empschedule.html");
              toggleList31.setAttribute("class", "dropdown-item");
              toggleList31.textContent = "個人排程瀏覽";
              let toggleList32 = document.createElement("a");
              toggleList32.setAttribute("href", "locschedule.html");
              toggleList32.setAttribute("class", "dropdown-item");
              toggleList32.textContent = "場地排程瀏覽";
              toggleList3.append(toggleList31);
              toggleList3.append(toggleList32);
              toggle3.append(toggleList3);
              sidebar.append(toggle3);
              break;
            case "4":
              let side4 = document.createElement("a");
              let icon4 = document.createElement("i");
              let toggle4 = document.createElement("div");
              toggle4.setAttribute("class", "nav-item dropdown");
              side4.setAttribute("class", "nav-link dropdown-toggle");
              side4.setAttribute("data-bs-toggle", "dropdown");
              side4.setAttribute("href", "#");
              icon4.setAttribute("class", "bi bi-pencil-square");
              side4.append(icon4);
              side4.append(" 訂單管理");
              toggle4.append(side4);
              let toggleList4 = document.createElement("div");
              toggleList4.setAttribute(
                "class",
                "dropdown-menu bg-transparent border-0"
              );
              let toggleList41 = document.createElement("a");
              toggleList41.setAttribute("href", "#");
              toggleList41.setAttribute("class", "dropdown-item");
              toggleList41.textContent = "方案訂單管理";
              let toggleList42 = document.createElement("a");
              toggleList42.setAttribute("href", "#");
              toggleList42.setAttribute("class", "dropdown-item");
              toggleList42.textContent = "追思品訂單管理";
              toggleList4.append(toggleList41);
              toggleList4.append(toggleList42);
              toggle4.append(toggleList4);
              sidebar.append(toggle4);
              break;
            case "5":
              let side5 = document.createElement("a");
              let icon5 = document.createElement("i");
              side5.setAttribute("class", "nav-item nav-link");
              side5.setAttribute("href", "#");
              icon5.setAttribute("class", "bi bi-folder-plus");
              side5.append(icon5);
              side5.append("會員管理");
              sidebar.append(side5);
              break;
            case "6":
              let side6 = document.createElement("a");
              let icon6 = document.createElement("i");
              let toggle6 = document.createElement("div");
              toggle6.setAttribute("class", "nav-item dropdown");
              side6.setAttribute("class", "nav-link dropdown-toggle");
              side6.setAttribute("data-bs-toggle", "dropdown");
              side6.setAttribute("href", "#");
              icon6.setAttribute("class", "bi bi-pencil-square");
              side6.append(icon6);
              side6.append(" 網站管理");
              toggle6.append(side6);
              let toggleList6 = document.createElement("div");
              toggleList6.setAttribute(
                "class",
                "dropdown-menu bg-transparent border-0"
              );
              let toggleList61 = document.createElement("a");
              toggleList61.setAttribute("href", "#");
              toggleList61.setAttribute("class", "dropdown-item");
              toggleList61.textContent = "網站資訊管理";
              let toggleList62 = document.createElement("a");
              toggleList62.setAttribute("href", "#");
              toggleList62.setAttribute("class", "dropdown-item");
              toggleList62.textContent = "智能客服管理";
              toggleList6.append(toggleList61);
              toggleList6.append(toggleList62);
              toggle6.append(toggleList6);
              sidebar.append(toggle6);
              break;
            case "7":
              let side7 = document.createElement("a");
              let icon7 = document.createElement("i");
              let toggle7 = document.createElement("div");
              toggle7.setAttribute("class", "nav-item dropdown");
              side7.setAttribute("class", "nav-link dropdown-toggle");
              side7.setAttribute("data-bs-toggle", "dropdown");
              side7.setAttribute("href", "#");
              icon7.setAttribute("class", "bi bi-pencil-square");
              side7.append(icon7);
              side7.append(" 後台管理");
              toggle7.append(side7);
              let toggleList7 = document.createElement("div");
              toggleList7.setAttribute(
                "class",
                "dropdown-menu bg-transparent border-0"
              );
              let toggleList71 = document.createElement("a");
              toggleList71.setAttribute("href", "empManage.html");
              toggleList71.setAttribute("class", "dropdown-item");
              toggleList71.textContent = "員工管理";
              let toggleList72 = document.createElement("a");
              toggleList72.setAttribute("href", "locManage.html");
              toggleList72.setAttribute("class", "dropdown-item");
              toggleList72.textContent = "場地管理";
              toggleList7.append(toggleList71);
              toggleList7.append(toggleList72);
              toggle7.append(toggleList7);
              sidebar.append(toggle7);
              break;
          }
        }
        connect();
      };
    </script>


<script>
  let chatBar = document.getElementById("chatBar");
  chatBar.addEventListener("click",function(){
     $("#chat").toggleClass("showChat");
     
  })
</script>


<!-- webSocket聊天室 -->
<script>
  // <div class="p-2 mb-2 bg-white text-dark" id="chat">
  //         <div class="p-2 mb-2 bg-danger text-white" id="chatBar" style="position: sticky;">
  //             <i class="bi bi-arrow-bar-left" id="chatBackbtn"></i>
  //             <span>聊天室</span>
             
  //         </div>
  //         <div style="background-color: black; width: 100%;height: 80%;">
              
  //         </div>
  //         <div class="inputHolder">
  //             <input type="text" id = "chatInput" style="width: 350px;">
  //             <button type="button" class="btn btn-outline-danger m-2" id="chatSendbtn">送出</button>
  //         </div>
  //       </div>
  let stompClient = null;
  let username = null;

  let chatInput = document.getElementById("chatInput");

  let chatArea = document.getElementById("messageArea");

  // let chatSendbtn = document.getElementById("chatSendbtn");

  // let chatbar = document.getElementById("chatBar");

function connect(event){
  console.log("connect");
  username = sessionStorage.getItem("ename");
  let socket = new SockJS("/ws");
  stompClient = Stomp.over(socket);
  stompClient.connect({},onConnect,onError);
  // event.preventDefault();
  
}

function onConnect(){
  console.log("onConnect");
  stompClient.subscribe("/chatroom/public",onMessageReceived)
}
function onError(error){
  console.log("error");
}

function send(event){
  console.log("send");
  let messageContext = chatInput.value.trim();

  if(messageContext&&stompClient){
    let messageSend ={
      senderName:username,
      message:chatInput.value,
      status:"MESSAGE",
      date:moment().format("YYYY-MM-D kk:mm")
    }
    stompClient.send("/app/message",{},JSON.stringify(messageSend));
  chatInput.value ="";
  };
  // event.preventDefault();
}

function onMessageReceived(payload){

  let message = JSON.parse(payload.body);
  console.log(message);

  let messageElement = document.createElement("div");

  messageElement.classList.add("chat-message");



  let usernameElement = document.createElement("span");
  let usernameText =document.createTextNode(message.senderName);
  usernameElement.appendChild(usernameText);
  messageElement.appendChild(usernameElement);

  let sendtime = document.createElement("span");
  let time =document.createTextNode(message.date);
  sendtime.setAttribute("style","color:gray;")
  sendtime.appendChild(time);
  messageElement.appendChild(sendtime);

  let textElement = document.createElement("p");
  let messageText = document.createTextNode(message.message);
  textElement.appendChild(messageText);

  messageElement.appendChild(textElement);

  chatArea.appendChild(messageElement);
  chatArea.scrollTop =chatArea.scrollHeight;


  // function getAvatarColor(messageSender){
  //   let hash = 0;
    
  //     hash =31*hash+messageSender.charCodeAt(i);
    
  //   let index = Math.abs(hash % colors.length);
  //   return colors[index];
  // }
// chatBar.addEventListener("click", connect, true);

// chatSendbtn.addEventListener("click",function(){console.log("click")},true);

}
</script>
  </body>
</html>
